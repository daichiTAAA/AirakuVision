# 要素作業分析 UI 設計書

## 1. 目的
本書は、要素作業分析 UI の画面構成、操作フロー、データ連携を定義し、分析担当者が効率的にラベリングと確認作業を行える設計を示す。

## 2. 適用範囲
- 分析担当者向け Web UI
- 要素作業ラベリング機能
- AI 候補区間提示機能
- レポート出力と共有

## 3. 関連要件
- 機能：F-040, F-041, F-042, F-043, F-044, F-050, F-051
- 非機能：N-017, N-018, N-019, N-020, N-021
- データ：D-004, D-005, D-006, D-009
- インターフェース：I-003, I-004
- 運用・保守：O-001, O-002
- リスク：R-003

## 4. ユーザーシナリオ
1. 分析担当者がログインし、担当ラインまたは月連番で対象動画を検索。
2. 動画を再生し、AI 候補区間を確認。必要に応じて開始・終了時刻やカテゴリを修正。
3. 追加ラベルを手動で入力し、保存。保存と同時に学習データ更新キューへ登録。
4. ラベリング結果をレポートで確認し、共有リンクを生成。
5. 作業履歴とレビューステータスを監督者が確認し、承認または差戻しを行う。

## 5. 画面構成
### 5.1 ダッシュボード
- 作業キュー一覧（優先度、期限、担当者）
- 進捗サマリ（完了件数、保留件数、平均処理時間）
- アラート（期限超過、低信頼度イベント、権限変更）

### 5.2 動画ラベリング画面
レイアウト構成：
- 上部：動画再生プレーヤー（再生・一時停止・倍速・スロー・区間ループ）
- 左側：AI 候補区間リスト（開始・終了、カテゴリ、信頼度、ステータス）
- 中央下部：タイムライン（ラベル帯表示、ズーム、マーカー移動）
- 右側：編集フォーム（カテゴリ、タグ、備考、プライバシーフラグ）
- 下部ステータスバー：現在時間、ショートカットヘルプ、保存状態

### 5.3 レポート画面
- フィルタ：期間、ライン、工程、カテゴリ
- 指標：要素作業時間、ばらつき、ボトルネック、確認待ち件数
- エクスポート：PDF/CSV、共有リンク生成

## 6. 機能詳細
### 6.1 ラベリング
- マウス操作またはキーボードショートカットで区間を設定。
- 登録時にカテゴリ・備考を入力し、保存ボタンで確定。保存成功時にトースト通知。
- ラベルはバージョン管理され、差分表示が可能。

### 6.2 AI 候補区間
- 候補は信頼度順に表示し、状態は「未確認」「承認」「修正」「破棄」。
- 承認時は開始・終了・カテゴリをそのまま採用、修正時は編集フォームで値を変更。
- 候補の学習利用可否を選択でき、修正内容は差分学習に使用。

### 6.3 レビュー機能
- レビュー担当者は変更履歴を参照し、承認または差戻しを実行。
- 差戻し時は理由を必須入力とし、担当者へ通知。
- 承認済みラベルはロックされ、再編集には再申請が必要。

### 6.4 レポート出力
- レポート生成は非同期で処理し、完了時に通知。
- KPI は事前に定義したメトリクスセットに基づき算出。
- 公開リンクは期限付きトークンで保護し、アクセスログを記録。

## 7. データ連携
| データ | 取得元 | 利用先 | 備考 |
|--------|--------|--------|------|
| 録画メタデータ | データマネジメント層 | UI キャッシュ | D-004 |
| AI 候補区間 | 学習サービス | UI | 信頼度、モデルバージョン | 
| ラベル結果 | UI | データマネジメント層、業務サービス層 | D-005 |
| レポート指標 | データマネジメント層 | UI | 定期同期 | 

## 8. 非機能設計
- 操作性：主要アクション 3 ステップ以内、キーボードショートカット対応。（N-020）
- 表示：高コントラストテーマとナイトモードを用意。（N-021）
- 性能：動画ロードは 3 秒以内、タイムラインズームは 0.5 秒以内。（N-001, N-003）
- 信頼性：自動保存機能で 30 秒間隔のドラフト保存を行い、ブラウザ異常終了時でも復元可能。（N-016）

## 9. セキュリティ
- ロールベースアクセス制御で「分析担当者」「レビュー担当」「監督者」に権限を限定。（F-050, N-009）
- ラベルデータ閲覧・編集ログを監査ログサービスへ送信。（F-051）
- 共有リンクは公開期限とアクセス回数制限を設定可能。（N-012）

## 10. 運用・保守
- UI リリース前にアクセシビリティレビューを実施し、改善点を記録。（O-003）
- 操作マニュアルとチュートリアルを用意し、教育時間 30 分以内を達成する。（N-019, R-003）
- 監視項目：ページロード時間、保存エラー率、レポート生成時間。閾値超過で運用チームへ通知。（O-001）

## 11. リスク対応
- R-003：作業集中による負荷増大時はキュー自動割当を導入し、担当者間で均等配分。
- UI 改修で混乱が生じないよう、変更点をアプリ内で告知し、旧 UI への一時切替機能を提供。

---
本設計を基に詳細 UI 仕様とモックアップを作成する。
