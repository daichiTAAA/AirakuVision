# システム基本設計書：映像・音声ベース作業分析自動化システム

## 1. 目的
本書は、企画書および要件定義書に基づき、システム全体の基本的な構成と振る舞いを定義する。各サブシステムに共通する設計原則を明確化し、詳細設計・開発・テスト工程への橋渡しを行うことを目的とする。

## 2. 適用範囲
- 対象：装着型デバイス層、配信・記録層、業務サービス層、データマネジメント層、分析・可視化層。
- 対象外：端末ハードウェアの筐体設計、工場内ネットワーク設備、外部システムの内部仕様。

## 3. 関連ドキュメント
- docs/01000_企画書/企画書.md
- docs/02000_要件定義書/要件定義書.md

## 4. 要件対応
- 機能要件：F-001〜F-053
- 非機能要件：N-001〜N-021
- データ要件：D-001〜D-009
- インターフェース要件：I-001〜I-004
- 運用・保守要件：O-001〜O-004
- リスク・課題：R-001〜R-004

## 5. システム全体構成
1. **装着型デバイス層**：現場作業者が装着するデバイスが映像・音声を取得し、作業イベントを入力する。
2. **配信・記録層**：低遅延伝送を担うストリーミングサービスと録画管理サービスで構成され、ライブ監視と再生を同一基盤で提供する。
3. **業務サービス層**：作業イベント、順序リスト、端末状態を扱う業務 API 群とワークフロー管理を提供する。
4. **データマネジメント層**：映像メタデータやイベントログを統合し、学習データ生成とレポーティングの基盤を準備する。
5. **分析・可視化層**：要素作業分析 UI、監視ダッシュボード、レポート機能により業務利用者へ情報を提供する。

![システム関連図](./システム関連図.svg)

## 6. デプロイメント概要
- 装着型デバイスは現場ネットワーク経由で配信・記録層へ接続する。
- 配信・記録層と業務サービス層は相互に連携し、イベント通知と映像メタデータ同期を実施する。
- データマネジメント層は業務サービス層からのイベントと録画情報をバッチおよびストリームで取り込み、可視化層へ提供する。
- 可視化層は利用者ロールに応じた認可を通過した上で、業務サービス層とデータマネジメント層にアクセスする。

## 7. アプリケーション層間インタラクション
| No  | 主体           | 相手                 | トリガー             | 主な処理                             | 関連要件            |
| --- | -------------- | -------------------- | -------------------- | ------------------------------------ | ------------------- |
| I-1 | 装着型デバイス | 配信・記録層         | 作業者の配信開始操作 | 映像・音声ストリームの開始、遅延監視 | F-010, F-012, N-001 |
| I-2 | 装着型デバイス | 業務サービス層       | 音声コマンド認識     | 作業イベント登録、月連番照合         | F-020, F-022, N-003 |
| I-3 | 配信・記録層   | データマネジメント層 | 録画完了             | 映像ファイル情報登録、メタデータ通知 | F-011, F-030, D-004 |
| I-4 | 業務サービス層 | 分析・可視化層       | レポート要求         | 要素作業データ提供、レポート生成     | F-044, N-017, D-005 |
| I-5 | 業務サービス層 | 運用監視機能         | 障害検知             | アラート発報、フェイルオーバー起動   | F-052, O-001, N-004 |

## 8. データフロー
1. 作業者が装着型デバイスで映像配信を開始。
2. 配信・記録層がストリームを受信し、映像をリアルタイム配信しながら録画を作成。
3. 音声コマンドから作業イベントが生成され、業務サービス層が順序リストと照合し状態を更新。
4. 録画完了後、メタデータがデータマネジメント層へ蓄積され、映像ファイルとイベントが紐付く。
5. 分析担当者が可視化層で要素作業分析を実施し、修正結果が学習データとして保存される。
6. ダッシュボードが稼働状況と指標を表示し、異常時には通知が送信される。

## 9. 品質設計方針
- **性能**：遅延・同時接続数・反映時間は N-001〜N-003 を基準に設計。負荷増大時には水平分割を優先する。
- **可用性**：冗長構成とフェイルオーバー設計を標準とし、監視と通知を O-001, N-004〜N-006 に沿って実装する。
- **セキュリティ**：通信暗号化、多要素認証、最小権限管理を徹底する。プライバシーゾーン対応を N-007〜N-013 に準拠して制御する。
- **運用性**：変更管理・バージョン整合性を O-002〜O-004 に従い、計画停止とロールバック手順を標準化する。

## 10. バージョン管理ポリシー
- 要件識別子とのトレーサビリティマトリクスを維持し、変更時は設計書の該当章および影響範囲を更新する。
- 設計レビューは少なくとも基本設計完了時とリリース前に実施し、承認記録を残す。

## 11. リスク対応
- R-001：音声認識精度低下に備え、補助入力装置のインターフェース設計を別途検討し、暫定措置として再入力導線を明記する。
- R-002：帯域不足への対応として、配信・記録層に帯域監視と動的ビットレート制御を組み込む。
- R-003：ラベリング負荷に対し、可視化層で作業キュー管理と教育用ガイドを提供する。
- R-004：法規制の変更に対応できるよう、プライバシー関連設定を構成ファイル化し、運用管理者が更新可能とする。
