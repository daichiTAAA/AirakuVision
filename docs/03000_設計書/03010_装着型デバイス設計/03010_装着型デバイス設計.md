# 装着型デバイス設計書

## 1. 目的
本書は、装着型デバイス層の基本設計を示し、作業者の利用シナリオに沿った機能・データ・操作フローを定義する。

## 2. 適用範囲
- 映像・音声取得、ストリーム送信、音声コマンド処理、プライバシーゾーン制御、端末管理機能。
- 端末ハードウェアの製造仕様は対象外。

## 3. 関連要件
- 機能：F-001, F-002, F-003, F-010, F-012, F-013, F-021, F-022
- 非機能：N-001, N-003, N-007, N-010, N-014, N-015, N-016, N-019
- データ：D-001, D-003, D-007, D-008
- インターフェース：I-001, I-002, I-004
- リスク：R-001, R-002

## 4. 役割と責務
| ロール | 役割 |
|--------|------|
| 現場作業者 | 映像配信と音声コマンド入力を実施し、確認プロンプトに応答する |
| ライン監督者 | 月連番の補正指示やプライバシーゾーン設定変更を行う |
| 運用管理者 | 端末登録、権限設定、ソフトウェア更新を管理する |

## 5. 機能設計
### 5.1 端末登録・認証
- 端末は初回起動時に運用管理者が発行した登録コードで業務サービス層へ登録する。
- 登録後は端末識別子と認証情報を安全に保管し、接続毎に業務サービス層で認可を受ける。

### 5.2 音声コマンド処理
- コマンド構造：`<端末識別ワード> <作業状態> <月連番>`。
- 認識確信度が閾値未満の場合は確認プロンプトを音声・画面で提示し、再入力または取消を受け付ける。
- 受理したコマンドは即時に業務サービス層へ送信し、冪等性確保のため端末内でシーケンス番号を付与する。

### 5.3 映像・音声取得
- 映像は装着者視点で常時取得し、遅延制御のためフレームサイズ・フレームレートを状況に応じて調整可能とする。
- 音声は指向性収音を活用し、騒音環境でも音声コマンドが抽出できるようフィルタリング処理を施す。

### 5.4 プライバシーゾーン対応
- ビーコン検知や位置情報によりプライバシーゾーンを認識し、入室時に映像・音声取得および送信を停止する。
- プライバシーゾーン退出時には利用者による確認操作を経て送信を再開する。
- 停止中に取得したデータは端末内にも保持しない。

### 5.5 状態表示
- 端末画面または音声出力で現在の作業状態、録画状態、通信状態を表示する。
- 異常時は視覚と聴覚の両方で警告を発し、再試行・連絡・終了の選択肢を示す。

## 6. データ設計
| データ項目 | 概要 | 保存先 | 関連要件 |
|------------|------|--------|----------|
| 端末登録情報 | 端末識別子、登録日時、割当ライン | 端末内安全領域、業務サービス層 | D-001 |
| コマンド送信キュー | 音声コマンド内容、信頼度、送信状態 | 端末内一時領域 | D-003, D-008 |
| ストリーム統計 | 帯域、遅延、パケット損失率 | 端末内一時領域、配信・記録層 | N-001, R-002 |
| プライバシーイベント | 入退室時刻、トリガー情報 | 業務サービス層 | F-003, D-003 |

## 7. 操作フロー
1. 端末起動後、認証と月連番同期を実施。
2. 作業者が配信開始操作を行うと映像・音声ストリームを開始。
3. 作業者が音声コマンドを発話し、端末が認識・確認を実施。
4. 端末が業務サービス層へ作業イベントを送信し、応答結果を表示。
5. プライバシーゾーンに入室すると配信を停止し、退出時に再開可否を確認。
6. 作業終了後、端末が配信停止とステータス更新を行う。

## 8. 非機能設計
- 遅延：初期設定で 1 秒以内を満たすよう、バッファ制御と優先度設定を行う。（N-001）
- 信頼性：オフライン時は音声コマンドを端末内キューへ蓄積し、再接続時に順序維持で送信する。（N-016）
- 可用性：端末稼働時間はバッテリー 8 時間以上を目標。省電力モードを装備し、充電率が閾値以下の場合はアラート。（N-015）
- ユーザビリティ：主要操作は 3 アクション以内で完了できる UI を提供し、音声フィードバックで結果を通知。（N-019, N-020）

## 9. 運用・保守設計
- 更新手順：運用管理者が管理コンソールから端末ソフトウェア更新を配信し、利用者の承認後に適用する。
- 監視：端末の接続状態・バッテリー残量・温度を周期的に業務サービス層へ送信し、閾値超過時に通知する。（O-001, F-053）
- 障害対応：通信断検知後は自動で再接続を試行し、再接続不可の場合は作業者に代替入力手段を案内する。（R-001, R-002）

## 10. セキュリティ・プライバシー
- 端末とサーバ間通信は暗号化し、証明書を用いた相互認証を実施する。（N-007）
- 端末内の個人情報は保持せず、ログイン情報は安全領域に保存する。
- プライバシーゾーンイベントは監査ログへ記録し、閲覧権限を制限する。（N-012, D-008）

---
本設計内容は詳細設計フェーズで補完し、変更時はトレーサビリティを維持する。
