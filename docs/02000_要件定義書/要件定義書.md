# 要件定義書：映像・音声ベース作業分析自動化システム

## 1. はじめに
### 1.1 目的
本書は、現場作業の映像と音声を統合的に収集・管理し、作業イベントの可視化と要素作業分析の効率化を実現するシステムの要件を定義する。企画段階で示されたコンセプトを具現化するために、関係者間で共通理解を形成することを目的とする。

### 1.2 背景
- 現場では作業手順の遵守、改善活動、品質トレーサビリティが重要視されている。
- 従来製品は導入コストが高く、自社要求に合わせた柔軟な拡張やリアルタイム判定に対応しづらい。
- ウェアラブル映像の低遅延配信や要素作業分析の自動化を実現する内製システムが求められている。

### 1.3 スコープ
- 対象範囲：映像・音声の取得、イベント管理、データ蓄積、手動・半自動分析、運用支援機能。
- 対象外：端末ハードウェアの製造、工場ネットワーク設備、外部システムの仕様変更。

### 1.4 想定読者
経営層、プロダクトオーナー、開発チーム、インフラ担当者、現場導入責任者、運用保守担当者。

## 2. システム概要
### 2.1 全体構成
1. **装着型デバイス層**：作業者視点の映像と音声を低遅延で送信し、音声指示により作業イベントを登録する。
2. **配信・記録層**：映像ストリームを受信・録画し、リアルタイム配信および過去映像の再生を提供する。
3. **業務サービス層**：作業イベント、月連番、工程情報を管理する業務 API 群を提供する。
4. **データマネジメント層**：順序データ、イベントログ、映像メタデータ、分析結果を統合管理し学習データとして活用する。
5. **分析・可視化層**：要素作業分析 UI、レポート、ダッシュボードにより現場改善を支援する。

### 2.2 利用ロール
- **現場作業者**：装着型デバイスを操作し、音声コマンドで作業イベントを登録。
- **ライン監督者**：進捗とイベント状態を監視し、異常時に対応。
- **分析担当者**：録画映像に対する要素作業ラベル付けと AI 候補の確認・修正を実施。
- **運用管理者**：端末登録、順序データ設定、利用権限管理、データ保持ポリシー運用を担当。
- **経営・改善担当**：可視化結果を基に改善計画を策定。

## 3. 用語定義
- **月連番**：各端末が月単位で採番する作業シリアル番号。
- **作業イベント**：開始・終了・中断・再開など作業状態の変化を表す記録。
- **順序リスト**：生産指示日、工程、型式などを月連番と紐付けた作業計画情報。
- **要素作業**：録画映像内で区切られる最小作業単位。
- **候補区間提示**：機械学習モデルが推定した要素作業の開始・終了候補を表示すること。
- **プライバシーゾーン**：録画・録音を禁止する領域。入退室を検知し配信を停止・再開する。

## 4. 利用シナリオ
1. 現場作業者が装着型デバイスを装着し、作業指示に基づき月連番を音声入力する。
2. 配信・記録層が映像を低遅延で中継しつつ録画データを保存する。
3. 音声コマンドにより開始イベントが登録され、順序リストとの照合で対象工程が自動特定される。
4. 作業終了時の音声入力で完了イベントが登録され、映像メタデータと工程情報が紐付く。
5. 騒音環境で認識結果が曖昧な場合、デバイスが確認プロンプトを返し再入力を促す。
6. 分析担当者が要素作業分析 UI で録画映像を再生し、候補区間を確認・修正して学習データを更新する。
7. ダッシュボードによりライン監督者と改善担当者が作業時間・異常・トレンドを把握する。

## 5. 機能要件
### 5.1 端末・デバイス管理
- **F-001**：端末登録・管理機能。端末識別子、利用可能ライン、許可された音声コマンドを設定できること。
- **F-002**：月連番管理機能。端末ごとの次回月連番を参照・更新でき、必要に応じて上書きできること。
- **F-003**：プライバシーゾーン検知機能。指定領域への入退室を検知し、配信・録画・音声取得を自動停止／再開できること。

### 5.2 映像・音声収集
- **F-010**：低遅延映像配信。装着型デバイスからの一人称映像を遅延許容値以内で配信できること。
- **F-011**：映像録画。指定フォーマットで映像を録画し、後日再生およびダウンロード要求に応えられること。
- **F-012**：音声イベント取得。音声コマンドをリアルタイムに解析し、作業イベントとして登録できること。
- **F-013**：確認プロンプト。音声認識が不確実な場合、利用者に確認を促し再入力を受け付けること。

### 5.3 作業イベント・順序管理
- **F-020**：作業イベント登録 API。開始・終了・中断・再開を受け取り、状態遷移を管理すること。
- **F-021**：端末ステータス参照 API。現在の作業状態、期待月連番、最終イベント時刻を返却すること。
- **F-022**：順序照合。音声で入力された月連番が順序リストに存在するかを検証し、不整合時は警告を返すこと。
- **F-023**：中断・再開履歴。中断理由や再開時刻を保存し、レポートで参照できること。

### 5.4 データマネジメント
- **F-030**：映像メタデータ管理。月連番、工程、型式、生産指示日と録画ファイルの関連を保持すること。
- **F-031**：イベントログ蓄積。作業イベントのタイムスタンプ、発話テキスト、認識信頼度を保持すること。
- **F-032**：順序データ取り込み。外部システムや CSV などから順序リストを定期的に取り込めること。
- **F-033**：データ検索。月連番や期間、ライン、工程で映像とイベントを横断検索できること。

### 5.5 要素作業分析
- **F-040**：再生 UI。録画映像を高速再生・スロー再生・区間ジャンプ付きで閲覧できること。
- **F-041**：ラベリング機能。要素作業の開始時刻をクリック入力し、名称・カテゴリ・備考を付与できること。
- **F-042**：候補区間提示。機械学習モデルが推定した要素候補を提示し、ユーザーが採用・修正・破棄を選択できること。
- **F-043**：差分学習。修正後の結果を学習データとして蓄積し、モデル更新に活用できること。
- **F-044**：レポート出力。要素作業時間、ばらつき、ボトルネック工程を可視化するレポートを生成できること。

### 5.6 運用・管理
- **F-050**：ユーザー・権限管理。ロール別に機能アクセス権限を設定できること。
- **F-051**：監査ログ。主要操作（映像閲覧、データ修正、権限変更）を記録し検索できること。
- **F-052**：通知連携。作業イベントの異常や配信停止をリアルタイムで通知できること。
- **F-053**：保守ダッシュボード。端末接続状況、配信負荷、ストレージ利用量を可視化できること。

## 6. 非機能要件
### 6.1 パフォーマンス
- **N-001**：端末から配信開始後、監視 UI に映像が表示されるまでの遅延は 1 秒以内を目標とする。
- **N-002**：同時視聴および録画セッション数は初期段階で 50 を想定し、水平方向への拡張が可能であること。
- **N-003**：作業イベント登録から状態反映までの処理時間は 1 秒以内とする。

### 6.2 可用性・信頼性
- **N-004**：映像配信・録画サービスの稼働率は月間 99.5% 以上を確保する。
- **N-005**：障害発生時に 5 分以内にフェイルオーバーまたはサービス再開が行えること。
- **N-006**：映像ファイルとイベントログは二重化し、整合性チェックを定期実行する。

### 6.3 セキュリティ
- **N-007**：端末からサーバ、サーバ間通信は暗号化する。
- **N-008**：利用者は多要素認証を用いてログインする。
- **N-009**：アクセス権限は最小権限の原則に従い、権限変更は承認ワークフローを経る。
- **N-010**：プライバシーゾーンで取得されたデータは保存せず、端末・サーバともに即時破棄する。

### 6.4 プライバシー・コンプライアンス
- **N-011**：映像・音声データの保持期間は原則 1 年とし、運用ポリシーに従い延長が可能とする。
- **N-012**：個人情報および映像の閲覧には理由記録と期限付き承認が必要である。
- **N-013**：データの取得・利用目的を作業者に周知し、必要な同意を取得する。

### 6.5 運用性
- **N-014**：システム更新は計画停止時間を事前周知し、影響を最小化する。
- **N-015**：端末は 8 時間以上の連続稼働が可能で、バッテリー交換計画を運用者が管理できること。
- **N-016**：オフライン時は端末内にデータを一時保存し、再接続時に自動同期する。

### 6.6 拡張性
- **N-017**：映像解析の追加アルゴリズムをモジュールとして登録し、ワークフロー内で組み合わせ可能とする。
- **N-018**：外部システム連携を想定し、メタデータ拡張やイベント種類追加が容易であること。

### 6.7 ユーザビリティ
- **N-019**：音声コマンドの語彙は作業者が覚えやすい単語数に制限し、訓練に要する時間を 30 分以内とする。
- **N-020**：要素作業分析 UI の主要操作はマウスとキーボードの複合で 3 アクション以内で完了できること。
- **N-021**：監視画面は現場環境に合わせ高コントラスト配色とする。

## 7. データ要件
### 7.1 主要データエンティティ
- **D-001**：端末マスタに端末識別子、所属ライン、状態、最終同期時刻を保持する。
- **D-002**：順序データに生産指示日、工程、型式、月連番、優先度、ステータスを保持する。
- **D-003**：作業イベントに端末識別子、イベント種別、タイムスタンプ、入力元、認識信頼度、補足メモを保持する。
- **D-004**：映像メタデータに録画 ID、保存パス、開始・終了時刻、関連月連番、工程情報、閲覧制限フラグを保持する。
- **D-005**：要素作業ラベルに映像 ID、開始・終了時刻、カテゴリ、担当者、学習利用可否を保持する。
- **D-006**：モデル更新履歴に更新日、対象モデル、使用データ、精度指標、承認者を保持する。

### 7.2 データ品質
- **D-007**：月連番の重複や抜けを検知する整合性チェックを日次で実施する。
- **D-008**：認識信頼度が閾値を下回るイベントは確認待ちステータスとし、監督者が承認または修正する。
- **D-009**：映像とイベントの紐付けを日次でサンプリング検査し、誤マッチ率を 1% 未満に抑える。

## 8. インターフェース要件
- **I-001**：作業イベント登録インターフェースは RESTful 形式とし、冪等性を担保する。
- **I-002**：順序データ取り込みはスケジュールバッチおよび手動アップロードに対応する。
- **I-003**：映像再生は監視 UI、分析 UI、外部ビューア向けに適切な配信形式を提供する。
- **I-004**：通知はメール、チャットツール、ダッシュボードアラートに対応し、送信テンプレートを設定可能とする。

## 9. 運用・保守要件
- **O-001**：稼働監視は 24 時間体制を想定し、重大アラートは即時エスカレーションされること。
- **O-002**：端末ファームウェアとサーバソフトウェアのバージョン管理を行い、互換性リストを維持する。
- **O-003**：定期メンテナンス手順とロールバック計画を文書化し、年 1 回以上検証する。
- **O-004**：災害対策として別拠点へのバックアップ複製と復旧訓練を半年に一度実施する。

## 10. リスクと課題
- **R-001**：騒音が極端に大きい環境では音声認識精度が低下する可能性があるため、補助入力手段を検討する。
- **R-002**：ネットワーク帯域が不足する拠点では映像遅延が許容値を超える恐れがあるため、事前調査と帯域保障策を講じる。
- **R-003**：ラベリング業務の負荷が高い場合、分析担当者のリソースが不足するため、段階的な自動化と教育計画を策定する。
- **R-004**：プライバシー保護に関する法規制が変更された場合、運用ルールや機能改修が必要になる。

---
本要件定義書は、関係者の合意形成と詳細設計への橋渡しを目的とする。追加・変更が発生した場合は要件審査プロセスを経て版管理を行うこと。
